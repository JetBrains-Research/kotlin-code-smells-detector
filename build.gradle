buildscript {
    ext.kotlin_version = '1.4.0-dev-6009'
    repositories {
        maven { url 'https://teamcity.jetbrains.com/guestAuth/app/rest/builds/buildType:(id:Kotlin_KotlinPublic_Compiler),number:1.4.0-dev-6009,branch:(default:any)/artifacts/content/maven' }
        mavenCentral()
        maven { url 'https://dl.bintray.com/kotlin/kotlin-eap/'}
        maven { url 'https://dl.bintray.com/kotlin/kotlin-dev/'}
        def teamcity = ivy {
            url 'https://teamcity.jetbrains.com/guestAuth/'
            patternLayout {

                artifact '/app/rest/builds/id:2879129/artifacts/content/[module]-[revision].[ext]'
            }
            metadataSources { artifact() }
        }
//        exclusiveContent {
//            forRepositories(teamcity)
//            filter { includeGroup("jetbrains") }
//        }
    }

    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath 'jetbrains:kotlin-plugin:1.4.0-dev-6009-IJ2020.1-Community-1@zip'
       // classpath "org.jetbrains.kotlin:kotlin-plugin:$kotlin_version"
    }
}

plugins {
    id 'java'
    id 'org.jetbrains.kotlin.jvm' version '1.4.0-dev-6009'
    id 'org.jetbrains.intellij' version '0.4.18'
  //  org.jetbrains.kotlin
}

repositories {
    maven { url 'https://teamcity.jetbrains.com/guestAuth/app/rest/builds/buildType:(id:Kotlin_KotlinPublic_Compiler),number:1.4.0-dev-6009,branch:(default:any)/artifacts/content/maven' }
    mavenCentral()
    jcenter()
    maven { url 'https://dl.bintray.com/kotlin/kotlin-eap/'}
    maven { url 'https://dl.bintray.com/kotlin/kotlin-dev/'}
    def teamcity = ivy {
        url 'https://teamcity.jetbrains.com/guestAuth/'
        patternLayout {

            artifact '/app/rest/builds/id:2879129/artifacts/content/[module]-[revision].[ext]'
        }
        metadataSources { artifact() }
    }
    exclusiveContent {
        forRepositories(teamcity)
        filter { includeGroup("jetbrains") }
    }
}

dependencies {
    compile "jetbrains:kotlin-plugin:1.4.0-dev-6009-IJ2020.1-Community-1@zip"
 //l   implementation "org.jetbrains.kotlin:kotlin-compiler:$kotlin_version"
//    implementation "org.jetbrains.kotlin:kotlin-reflect:$kotlin_version"
}
//
//allprojects {
//    apply plugin: 'idea'
//    apply plugin: 'kotlin'
//    idea {
//        module {
//            downloadSources = true
//            downloadJavadoc = true
//        }
//    }
//}

task unzip(type: Copy) {

    def zipPath = project.configurations.compile.find {it.name.startsWith("kotlin-plugin") }
    println zipPath
    def zipFile = file(zipPath)
    def outputDir = file("${buildDir}")

    from zipTree(zipFile)
    into outputDir
}
dependencies {
   // api "org.jetbrains:kotlin:kotlin-compiler:1.4.0-dev-6009"
    //implementation fileTree(dir: '/${buildDir}/Kotlin/lib', include: ['*.jar'])
//     api files("${buildDir}/Kotlin/lib/ide-common.jar",
//            "${buildDir}/Kotlin/lib/kotlin-util-klib-metadata.jar",
//            "${buildDir}/Kotlin/lib/kotlin-scripting-compiler-impl.jar",
//            "${buildDir}/Kotlin/lib/sam-with-receiver-ide-plugin.jar",
//            "${buildDir}/Kotlin/lib/noarg-ide-plugin.jar",
//            "${buildDir}/Kotlin/lib/kotlin-noarg-compiler-plugin.jar",
//            "${buildDir}/Kotlin/lib/android-extensions-compiler.jar",
//            "${buildDir}/Kotlin/lib/android-extensions-ide.jar",
//            "${buildDir}/Kotlin/lib/kotlin-sam-with-receiver-compiler-plugin.jar",
//            "${buildDir}/Kotlin/lib/kotlin-script-runtime.jar",
//            "${buildDir}/Kotlin/lib/kotlin-script-util.jar",
//            "${buildDir}/Kotlin/lib/kotlin-scripting-common.jar",
//            "${buildDir}/Kotlin/lib/kotlin-scripting-intellij.jar",
//            "${buildDir}/Kotlin/lib/kotlin-scripting-jvm.jar",
//            "${buildDir}/Kotlin/lib/kotlinx-serialization-compiler-plugin.jar",
//             "${buildDir}/Kotlin/lib/allopen-ide-plugin.jar",
//             "${buildDir}/Kotlin/lib/annotations-13.0.jar",
//             "${buildDir}/Kotlin/lib/javaslang-match-2.0.6.jar",
//             "${buildDir}/Kotlin/lib/javaslang-2.0.6.jar",
//             "${buildDir}/Kotlin/lib/javax.inject-1.jar",
//             "${buildDir}/Kotlin/lib/kapt3-idea.jar",
//             "${buildDir}/Kotlin/lib/kotlin-allopen-compiler-plugin.jar",
//             "${buildDir}/Kotlin/lib/kotlin-daemon.jar",
//             "${buildDir}/Kotlin/lib/kotlin-daemon-client.jar",
//             "${buildDir}/Kotlin/lib/kotlin-daemon-client-new.jar",
//             "${buildDir}/Kotlin/lib/kotlin-coroutines-experimental-compat.jar",
//             "${buildDir}/Kotlin/lib/kotlin-compiler-client-embeddable.jar",
//             "${buildDir}/Kotlin/lib/kotlin-plugin.jar",
//             "${buildDir}/Kotlin/lib/kotlin-gradle-tooling.jar",
//             "${buildDir}/Kotlin/lib/kotlin-util-io.jar",
//             "${buildDir}/Kotlin/lib/kotlin-util-klib.jar",
//             "${buildDir}/Kotlin/lib/kotlinx-collections-immutable-jvm-0.3.1.jar",
//             "${buildDir}/Kotlin/lib/kotlinx-coroutines-core-1.2.1.jar",
//             "${buildDir}/Kotlin/lib/kotlinx-coroutines-jdk8-1.2.1.jar",
//             "${buildDir}/Kotlin/lib/markdown-0.1.25.jar",
//             "${buildDir}/Kotlin/lib/jps/kotlin-jps-plugin.jar",
//             "${buildDir}/Kotlin/lib/completion-ranking-kotlin-0.1.2.jar",
//             "${buildDir}/Kotlin/lib/kotlin-stdlib-jdk8.jar",
//             "${buildDir}/Kotlin/lib/kotlin-stdlib-jdk7.jar",
//             "${buildDir}/Kotlin/lib/kotlin-stdlib-common.jar",
//             "${buildDir}/Kotlin/lib/kotlin-stdlib.jar",
//             "${buildDir}/Kotlin/lib/kotlin-reflect.jar",
//     )
}
sourceCompatibility = 1.8

//apply plugin: 'java'
//apply plugin: 'kotlin'
//apply plugin: org.jetbrains.kotlin
//apply plugin: 'org.jetbrains.intellij'

intellij {
    version '2020.1.1'
    version '2020.1'
    plugins = ['Kotlin', 'java']
    // plugins = ['java']

    pluginName 'KotlinCodeSmellDetector'
    downloadSources true
    intellij.updateSinceUntilBuild false
}

compileKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
    }
}
compileTestKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
    }
}